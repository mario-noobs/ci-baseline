---
- name: Cleanup unused Docker images
  hosts: app_servers
  become: true

  tasks:
    - name: Prune unused Docker images
      ansible.builtin.command:
        cmd: docker image prune -af --filter "until=168h"
      register: prune_result
      changed_when: "'Total reclaimed space' in prune_result.stdout"

    - name: Show pruned space
      ansible.builtin.debug:
        msg: "{{ prune_result.stdout_lines | last }}"
      when: prune_result.stdout_lines | length > 0
