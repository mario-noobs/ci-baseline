---
# ============================================================
# Application services â€” CUSTOMIZE for your project
# ============================================================
app_services:
  CHANGEME_backend:
    image: "{{ registry }}/CHANGEME_backend"
    tag: "latest"
    port: 8080
    health_check: "/ping"
    health_check_interval: 30
    env:
      SERVER_PORT: "8080"
      DB_HOST: "mysql"
      DB_PORT: "3306"
      DB_NAME: "CHANGEME_db"
      DB_USERNAME: "root"
      DB_PASSWORD: "{{ vault_db_password }}"
    resources:
      memory: "640M"
    depends_on:
      - mysql
      - redis

  CHANGEME_frontend:
    image: "{{ registry }}/CHANGEME_frontend"
    tag: "latest"
    port: 80
    resources:
      memory: "128M"
    depends_on:
      - CHANGEME_backend

# ============================================================
# Infrastructure services
# ============================================================
infra_services:
  mysql:
    enabled: "{{ has_mysql }}"
    image: "mysql:8.0"
    port: 3306
    env:
      MYSQL_ROOT_PASSWORD: "{{ vault_db_password }}"
      MYSQL_DATABASE: "CHANGEME_db"
    volumes:
      - "mysql_data:/var/lib/mysql"
    command: >-
      --innodb-buffer-pool-size={{ mysql_buffer_pool_size }}
      --max-connections={{ mysql_max_connections }}
    resources:
      memory: "512M"
    health_check_cmd: "mysqladmin ping -h localhost"

  redis:
    enabled: "{{ has_redis }}"
    image: "redis:7.4-alpine"
    port: 6379
    command: "redis-server --maxmemory {{ redis_maxmemory }} --maxmemory-policy allkeys-lru"
    volumes:
      - "redis_data:/data"
    resources:
      memory: "96M"
    health_check_cmd: "redis-cli ping"
